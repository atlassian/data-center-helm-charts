apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: bamboo-agent-claim
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: bamboo-local-home
  resources:
    requests:
      storage: 1Gi

---

apiVersion: v1
kind: Pod
metadata:
  name: bamboo-agent
spec:
  securityContext:
    fsGroup: 1000
  containers:
    - image: atlassian/bamboo-agent-base
      name:  bamboo-agent
      args: ["https://bamboo-k8s.deplops.com"]
      env:
        - name: VM_OPTS
          value: "-Dwrapper.java.initmemory=512 -Dwrapper.java.maxmemory=2048"
      volumeMounts:
        - mountPath: /home/bamboo/bamboo-agent-home/bin
          name: bamboo-agent-home
  volumes:
    - name: bamboo-agent-home
      persistentVolumeClaim:
        claimName: bamboo-agent-claim